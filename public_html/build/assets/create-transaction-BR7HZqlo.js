function s(t){return!t||parseFloat(t)===0?"0":t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,".")}function a(){let t=0,c=0;document.querySelectorAll(".product-item").forEach(function(d){var r;const e=d.querySelector(".product-select"),n=parseInt(d.querySelector(".quantity-input").value)||0,o=parseFloat((r=e.options[e.selectedIndex])==null?void 0:r.getAttribute("data-price"))||0,u=o*n;c=o,d.querySelector(".subtotal-input").value=s(u),t+=u}),document.getElementById("price").value=s(c),document.getElementById("total_price_display").value=s(t),document.getElementById("total_price").value=t.toFixed(2),m(),i()}function m(){const t=parseFloat(document.getElementById("total_price").value)||0,c=document.getElementById("customer_id").selectedOptions[0].id,d=document.getElementById("is_returned").selectedOptions[0].id;let e=0;c.startsWith("regular-")&&d.startsWith("false")&&(e=t*.05),document.getElementById("discount").value=s(e),document.getElementById("discount_save").value=e.toFixed(2)}function i(){const t=parseFloat(document.getElementById("total_price").value)||0,c=parseFloat(document.getElementById("payment").value)||0,d=parseFloat(document.getElementById("total_price").value)||0,e=document.getElementById("customer_id").selectedOptions[0].id,n=document.getElementById("is_returned").selectedOptions[0].id;let o=0,u=0,r=0;e.startsWith("regular-")&&n.startsWith("false")?(o=d*.05,u=o,r=d-o):e.startsWith("customer-")&&n.startsWith("false")&&(u=d*.1,r=d);let l=c-t+o;document.getElementById("final_price_display").value=s(r),document.getElementById("final_price").value=r,document.getElementById("change_display").value=s(l),document.getElementById("change").value=l>=0?l.toFixed(2):0,document.getElementById("payment").value=c>=0?c.toFixed(2):0,document.getElementById("profit").value=u>=0?u.toFixed(2):0}function p(){const t=document.getElementById("customer_id"),c=document.getElementById("is_returned"),d=document.getElementById("payment_fake");t.addEventListener("change",function(){const e=this.selectedOptions[0].id,n=c.selectedOptions[0].id,o=document.getElementById("regular"),u=document.getElementById("returned"),r=document.getElementById("payment_fake");o.classList.add("d-none"),r.setAttribute("required","true"),n.startsWith("true")?d.removeAttribute("required"):e.startsWith("regular-")&&n.startsWith("false")&&(o.classList.remove("d-none"),u.classList.remove("d-none")),m(),i()}),c.addEventListener("change",function(){const e=this.selectedOptions[0].id,n=document.getElementById("returned"),o=document.getElementById("regular");n.classList.add("d-none"),o.classList.add("d-none"),d.setAttribute("required","true"),e.startsWith("false")?n.classList.remove("d-none"):e.startsWith("true")&&d.removeAttribute("required"),m(),i()}),d.addEventListener("input",function(){let e=this.value.replace(/[^0-9]/g,"");document.getElementById("payment").value=e,this.value=s(e),i()}),document.getElementById("add-product").addEventListener("click",function(){const e=document.getElementById("products-wrapper"),n=document.querySelector(".product-item").cloneNode(!0),o=document.querySelectorAll(".product-item").length;n.querySelector(".product-select").selectedIndex=0,n.querySelector(".quantity-input").value=1,n.querySelector(".subtotal-input").value="",n.querySelector(".product-select").setAttribute("name",`products[${o}][product_id]`),n.querySelector(".quantity-input").setAttribute("name",`products[${o}][quantity]`),n.querySelector(".subtotal-input").setAttribute("name",`products[${o}][subtotal]`),e.appendChild(n)}),document.getElementById("products-wrapper").addEventListener("click",function(e){e.target.classList.contains("remove-product")&&document.querySelectorAll(".product-item").length>1&&(e.target.closest(".product-item").remove(),a())}),document.getElementById("products-wrapper").addEventListener("change",function(e){(e.target.classList.contains("product-select")||e.target.classList.contains("quantity-input"))&&a()})}document.addEventListener("DOMContentLoaded",function(){const t=new Date;t.setMinutes(t.getMinutes()-t.getTimezoneOffset()),document.getElementById("transaction_date").value=t.toISOString().slice(0,16),p(),a(),window.addEventListener("load",function(){document.getElementById("customer_id").dispatchEvent(new Event("change"))})});
